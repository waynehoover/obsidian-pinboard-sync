var be=Object.create;var A=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var ye=Object.getOwnPropertyNames;var Pe=Object.getPrototypeOf,Ce=Object.prototype.hasOwnProperty;var W=n=>A(n,"__esModule",{value:!0});var J=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),we=(n,e)=>{W(n);for(var t in e)A(n,t,{get:e[t],enumerable:!0})},Se=(n,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ye(e))!Ce.call(n,s)&&s!=="default"&&A(n,s,{get:()=>e[s],enumerable:!(t=fe(e,s))||t.enumerable});return n},k=n=>Se(W(A(n!=null?be(Pe(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var te=J((Ke,ee)=>{var S=1e3,v=S*60,E=v*60,w=E*24,Te=w*7,Ne=w*365.25;ee.exports=function(n,e){e=e||{};var t=typeof n;if(t==="string"&&n.length>0)return qe(n);if(t==="number"&&isFinite(n))return e.long?$e(n):Oe(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function qe(n){if(n=String(n),!(n.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(!!e){var t=parseFloat(e[1]),s=(e[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return t*Ne;case"weeks":case"week":case"w":return t*Te;case"days":case"day":case"d":return t*w;case"hours":case"hour":case"hrs":case"hr":case"h":return t*E;case"minutes":case"minute":case"mins":case"min":case"m":return t*v;case"seconds":case"second":case"secs":case"sec":case"s":return t*S;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Oe(n){var e=Math.abs(n);return e>=w?Math.round(n/w)+"d":e>=E?Math.round(n/E)+"h":e>=v?Math.round(n/v)+"m":e>=S?Math.round(n/S)+"s":n+"ms"}function $e(n){var e=Math.abs(n);return e>=w?U(n,e,w,"day"):e>=E?U(n,e,E,"hour"):e>=v?U(n,e,v,"minute"):e>=S?U(n,e,S,"second"):n+" ms"}function U(n,e,t,s){var i=e>=t*1.5;return Math.round(n/t)+" "+s+(i?"s":"")}});var se=J((We,ne)=>{function De(n){t.debug=t,t.default=t,t.coerce=p,t.disable=a,t.enable=i,t.enabled=c,t.humanize=te(),t.destroy=u,Object.keys(n).forEach(r=>{t[r]=n[r]}),t.names=[],t.skips=[],t.formatters={};function e(r){let o=0;for(let l=0;l<r.length;l++)o=(o<<5)-o+r.charCodeAt(l),o|=0;return t.colors[Math.abs(o)%t.colors.length]}t.selectColor=e;function t(r){let o,l=null,P,$;function b(...m){if(!b.enabled)return;let C=b,D=Number(new Date),he=D-(o||D);C.diff=he,C.prev=o,C.curr=D,o=D,m[0]=t.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let R=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(H,ge)=>{if(H==="%%")return"%";R++;let K=t.formatters[ge];if(typeof K=="function"){let me=m[R];H=K.call(C,me),m.splice(R,1),R--}return H}),t.formatArgs.call(C,m),(C.log||t.log).apply(C,m)}return b.namespace=r,b.useColors=t.useColors(),b.color=t.selectColor(r),b.extend=s,b.destroy=t.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>l!==null?l:(P!==t.namespaces&&(P=t.namespaces,$=t.enabled(r)),$),set:m=>{l=m}}),typeof t.init=="function"&&t.init(b),b}function s(r,o){let l=t(this.namespace+(typeof o=="undefined"?":":o)+r);return l.log=this.log,l}function i(r){t.save(r),t.namespaces=r,t.names=[],t.skips=[];let o,l=(typeof r=="string"?r:"").split(/[\s,]+/),P=l.length;for(o=0;o<P;o++)!l[o]||(r=l[o].replace(/\*/g,".*?"),r[0]==="-"?t.skips.push(new RegExp("^"+r.slice(1)+"$")):t.names.push(new RegExp("^"+r+"$")))}function a(){let r=[...t.names.map(d),...t.skips.map(d).map(o=>"-"+o)].join(",");return t.enable(""),r}function c(r){if(r[r.length-1]==="*")return!0;let o,l;for(o=0,l=t.skips.length;o<l;o++)if(t.skips[o].test(r))return!1;for(o=0,l=t.names.length;o<l;o++)if(t.names[o].test(r))return!0;return!1}function d(r){return r.toString().substring(2,r.toString().length-2).replace(/\.\*\?$/,"*")}function p(r){return r instanceof Error?r.stack||r.message:r}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}ne.exports=De});var _=J((g,L)=>{g.formatArgs=Ae;g.save=ke;g.load=Ie;g.useColors=Re;g.storage=Ue();g.destroy=(()=>{let n=!1;return()=>{n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();g.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Re(){if(typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let n;return typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&(n=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(n[1],10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Ae(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+L.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,s=0;n[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(s=t))}),n.splice(s,0,e)}g.log=console.debug||console.log||(()=>{});function ke(n){try{n?g.storage.setItem("debug",n):g.storage.removeItem("debug")}catch(e){}}function Ie(){let n;try{n=g.storage.getItem("debug")}catch(e){}return!n&&typeof process!="undefined"&&"env"in process&&(n=process.env.DEBUG),n}function Ue(){try{return localStorage}catch(n){}}L.exports=se()(g);var{formatters:Le}=L.exports;Le.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});we(exports,{default:()=>Y});var O=k(require("obsidian"));var Z=k(require("obsidian")),I=class extends Z.Modal{constructor(e,t){super(e);this.config=t;let{cta:s,onAccept:i,text:a,title:c}=t;this.contentEl.createEl("h2",{text:c}),this.contentEl.createEl("p",{text:a}),this.contentEl.createEl("button",{text:"Never mind"}).addEventListener("click",()=>{this.close()}),this.contentEl.createEl("button",{cls:"mod-cta",text:s}).addEventListener("click",async d=>{this.accepted=!0,this.close(),setTimeout(()=>i(d),20)})}onClose(){var e,t;this.accepted||(t=(e=this.config).onCancel)==null||t.call(e)}};var f=k(require("obsidian"));var ve=30*60,Ee="pinboard/",Fe="Username:SecretTokenCode",xe=20,X=Object.freeze({apiToken:Fe,hasAcceptedDisclaimer:!1,latestSyncTime:0,isSyncEnabled:!1,syncInterval:ve,tagPrefix:Ee,recentCount:xe,singleFileNoteName:"Pinboard Pins"}),V=class extends f.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){this.containerEl.empty(),this.containerEl.createEl("h3",{text:"Pinboard"}),this.addApiTokenSetting(),this.containerEl.createEl("h3",{text:"Format"}),this.addTagPrefixSetting(),this.containerEl.createEl("h3",{text:"Sync"}),this.addSyncEnabledSetting(),this.addSyncIntervalSetting(),this.addRecentCountSetting(),this.addSingleFileNoteNameSetting()}addApiTokenSetting(){new f.Setting(this.containerEl).setName("Token").setDesc("Pinboard API Token").addText(e=>{e.setValue(this.plugin.settings.apiToken),e.onChange(async t=>{let s=t.trim();this.plugin.writeSettings({apiToken:s})})})}addRecentCountSetting(){new f.Setting(this.containerEl).setName("Recent Posts").setDesc("Number of recent posts the plugin will read to sync").addText(e=>{e.setValue(String(this.plugin.settings.recentCount)),e.inputEl.type="number",e.inputEl.onblur=t=>{let s=Number(t.target.value);e.setValue(String(s)),this.plugin.writeSettings({recentCount:s})}})}addTagPrefixSetting(){new f.Setting(this.containerEl).setName("Tag Prefix").setDesc("Prefix added to Pinboard tags when imported into Obsidian (e.g. #pinboard/work)").addText(e=>{e.setValue(this.plugin.settings.tagPrefix),e.onChange(async t=>{this.plugin.writeSettings({tagPrefix:t})})})}addSyncEnabledSetting(){new f.Setting(this.containerEl).setName("Enable periodic syncing").addToggle(e=>{e.setValue(this.plugin.settings.isSyncEnabled),e.onChange(async t=>{this.plugin.writeSettings({isSyncEnabled:t})})})}addSyncIntervalSetting(){new f.Setting(this.containerEl).setName("Sync Frequency").setDesc("Number of seconds the plugin will wait before syncing again").addText(e=>{e.setValue(String(this.plugin.settings.syncInterval)),e.inputEl.type="number",e.inputEl.onblur=t=>{let s=Number(t.target.value);e.setValue(String(s)),this.plugin.writeSettings({syncInterval:s})}})}addTagPrefixSetting(){new f.Setting(this.containerEl).setName("Tag Prefix").setDesc("Prefix added to Pinboard tags when imported into Obsidian (e.g. #pinboard/work)").addText(e=>{e.setValue(this.plugin.settings.tagPrefix),e.onChange(async t=>{this.plugin.writeSettings({tagPrefix:t})})})}addSingleFileNoteNameSetting(){new f.Setting(this.containerEl).setName("Single File Note Name").setDesc("Name of the single file where Pinboard pins will be stored").addText(e=>{e.setValue(this.plugin.settings.singleFileNoteName),e.onChange(async t=>{this.plugin.writeSettings({singleFileNoteName:t})})})}};var Me=require("http"),je=require("https"),He=_(),ie=He("shr"),h=class{constructor(e){this.name=e.noEncodeName?e.name:encodeURIComponent(e.name),this.value=e.noEncodeValue?e.value:encodeURIComponent(e.value)}clone(){return new h({name:this.name,value:this.value,noEncodeName:!0,noEncodeValue:!0})}},F=class{constructor(e){this.host=e.host,this.basePath=e.basePath,this.protocol=typeof e.protocol!="undefined"?e.protocol:"https:",this.port=typeof e.port!="undefined"?e.port:443,this.parseJson=typeof e.parseJson!="undefined"?e.parseJson:!1,this.queryParams=typeof e.queryParams!="undefined"?e.queryParams:[],this.method=typeof e.method!="undefined"?e.method:"GET",this.postData=typeof e.postData!="undefined"?e.postData:""}get path(){return`/${this.basePath.join("/")}${this.urlParametersString}`}get urlParametersString(){let e="";return this.queryParams.forEach(t=>{e.length===0?e+="?":e+="&",e+=`${t.name}=${t.value}`}),e}get fullUrl(){return`${this.protocol}//${this.host}:${this.port}${this.path}`}clone(e){let t=new F({host:this.host,basePath:[],protocol:this.protocol,port:this.port,parseJson:this.parseJson,queryParams:[],method:this.method,postData:this.postData});return this.basePath.forEach(s=>t.basePath.push(s)),this.queryParams.forEach(s=>t.queryParams.push(s.clone())),e&&e.subPath&&e.subPath.forEach(s=>t.basePath.push(s)),e&&e.appendQueryParams&&e.appendQueryParams.forEach(s=>t.queryParams.push(s.clone())),t}equals(e){return this.path===e.path&&this.parseJson===e.parseJson&&this.method===e.method&&this.postData===e.postData}get nodeRequestOpts(){return{host:this.host,path:this.path,protocol:this.protocol,port:this.port,method:this.method}}},x=class{req(e){return ie(`${e.method} ${e.fullUrl}`),new Promise((t,s)=>{let i=!1,a=e.nodeRequestOpts,c=[],d;if(e.protocol==="https:")d=je.request(a);else if(e.protocol==="http:")d=Me.request(a);else throw new Error(`Unknown protocol ${e.protocol}`);d.on("response",p=>{p.statusCode?(p.statusCode<200||p.statusCode>=300)&&(i=!0):ie("Got a response from the webserver that has no .statusCode property"),p.on("data",u=>c.push(u)),p.on("end",()=>{let u=Buffer.concat(c).toString(),r,o;if(o=u,i)r=new Error(`ERROR ${p.statusCode} when attempting to ${e.method} '${e.fullUrl}'\r
${u}`);else if(e.parseJson)try{o=JSON.parse(u)}catch(l){r=new Error(`JSON Parse error: ${l} when receiving code ${p.statusCode} after performing ${e.method} on '${e.fullUrl}' and attempting to parse body:\r
${u}`)}r?s(r):t(o)})}),d.on("error",p=>s(p)),e.postData&&d.write(e.postData),d.end()})}};var Je=_(),T=Je("pbsdk"),y=class{static boolean(e){if(e==="yes"||e==="true"||e===1)return!0;if(e==="no"||e==="false"||e===0)return!1;throw`Unable to parse '${e}'`}static dateFormatter(e){return e.toISOString()}},B=class{constructor(e,t){this.name=e;t&&(this.count=t)}},M=class{constructor(e,t,s,i,a,c,d,p,u=[]){this.href=e;this.description=t;this.extended=s;this.meta=i;this.hash=a;this.time=c;this.shared=d;this.toread=p;this.tags=u}static fromObj(e){let t=new M(e.href,e.description,e.extended,e.meta,e.hash,new Date(e.time),y.boolean(e.shared),y.boolean(e.toread));return e.tags.split(" ").forEach(s=>t.tags.push(new B(s))),t}uiString(){let e=[];this.tags.forEach(s=>e.push(s.name));let t="";return t+=`----------------
`,t+=this.description?`${this.description}
`:`UNTITLED BOOKMARK
`,t+=`<${this.href}>
`,t+=this.extended?`${this.extended}
`:"",t+=`bookmarked: ${y.dateFormatter(this.time)}
`,t+=`public: ${this.shared}, toread: ${this.toread}
`,t+=`tags: ${e.join(" ")}
`,t+=`----------------
`,t}},N=class{constructor(e,t,s=[]){this.date=e;this.user=t;this.posts=s}uiString(){let e=`PinboardPostCollection for user ${this.user} on ${y.dateFormatter(this.date)}
`;return e+=`================

`,this.posts.forEach(t=>e+=`${t.uiString()}
`),e+=`================
`,e}static fromHttpResponse(e){let t=new N(new Date(e.date),e.user);return e.posts.forEach(s=>t.posts.push(M.fromObj(s))),T(`Got a PostCollection with ${t.posts.length} posts`),t}},q=class{constructor(e,t,s,i,a,c){this.id=e;this.title=t;this.createDate=s;this.updateDate=i;this.hash=a;this.text=c}static fromHttpResponse(e){return new q(e.id,e.title,new Date(e.created_at),new Date(e.updated_at),e.text?e.text:"",e.hash)}},re=class{constructor(e,t){this.note=e;this.post=t}uiString(){let e=[];this.post.tags.forEach(s=>e.push(s.name));let t="";return t+=`----------------
`,t+=`Note: ${this.note.title} (id ${this.note.id}
`,t+=`${this.note.text}
`,t+=`added: ${y.dateFormatter(this.note.createDate)} `,t+=`updated: ${y.dateFormatter(this.note.updateDate)}
`,t+=`public: ${this.post.shared}`,t+=`tags: ${e.join(" ")}
`,t+=`----------------
`,t}},oe=class{constructor(e,t=new x){this.request=t;this.noun="posts";this.urlOpts=e.clone({subPath:[this.noun]})}update(){let e=this.urlOpts.clone({subPath:["update"]});return this.request.req(e).then(t=>(T(`Last update time: ${t.update_time}`),new Date(t.update_time)))}get(e=[],t,s,i=!1){if(e.length>3)throw"Only three tags are supported for this request";let a=this.urlOpts.clone({subPath:["get"]});return e.forEach(c=>{a.queryParams.push(new h({name:"tag",value:c}))}),t&&a.queryParams.push(new h({name:"dt",value:y.dateFormatter(t)})),s&&a.queryParams.push(new h({name:"url",value:s})),a.queryParams.push(new h({name:"meta",value:i?"yes":"no"})),this.request.req(a).then(c=>N.fromHttpResponse(c))}recent(e=[],t){if(e.length>3)throw"Only three tags are supported for this request";if(typeof t!="undefined"&&(t>100||t<0))throw`Invalid value for 'count': '${t}'. Must be between 0-100.`;let s=this.urlOpts.clone({subPath:["recent"]});return e.forEach(i=>{s.queryParams.push(new h({name:"tag",value:i}))}),t&&s.queryParams.push(new h({name:"count",value:String(t)})),this.request.req(s).then(i=>N.fromHttpResponse(i))}},ae=class{constructor(e,t=new x){this.request=t;this.noun="tags";this.urlOpts=e.clone({subPath:[this.noun]})}get(){let e=this.urlOpts.clone({subPath:["get"]});return this.request.req(e).then(t=>{let s=[];for(let i in t)s.push(new B(i,t[i]));return T(`Got ${s.length} tags`),s})}rename(e,t){let s=this.urlOpts.clone({subPath:["rename"]});return s.queryParams.push(new h({name:"old",value:e})),s.queryParams.push(new h({name:"new",value:t})),this.request.req(s).then(i=>(T(`Got result: ${i}`),i))}},le=class{constructor(e,t=new x){this.request=t;this.noun="notes";this.urlOpts=e.clone({subPath:[this.noun]})}list(){let e=this.urlOpts.clone({subPath:["list"]});return this.request.req(e).then(t=>{let s=[];return t.notes.forEach(i=>s.push(q.fromHttpResponse(i))),s})}get(e){if(e.length<1)throw"An empty string is an invalid noteid.";let t=this.urlOpts.clone({subPath:[e]});return this.request.req(t).then(s=>q.fromHttpResponse(s))}},ce=class{constructor(e,t,s){this.notesEndpoint=e;this.postsEndpoint=t;this.notesUrlOpts=s}postFromNote(e){let t=this.notesUrlOpts.clone({subPath:[e.id]}).fullUrl;return this.postsEndpoint.get(void 0,void 0,t).then(s=>{if(s.posts.length!=1)throw`Expected to find bookmark for URL ${t}, but found ${s.posts.length} instead.`;return new re(e,s.posts[0])})}list(){return this.notesEndpoint.list().then(e=>{let t=[];return e.forEach(s=>t.push(this.get(s.id))),Promise.all(t)})}get(e){return this.notesEndpoint.get(e).then(t=>this.postFromNote(t))}},j=class{constructor(e,t){this.user=e;this.secret=t;if(e.length<1||t.length<1)throw"Invalid API token string"}toString(){return`${this.user}${j.separator}${this.secret}`}static fromString(e){let t=e.split(this.separator),[s,i]=t;if(t.length!=2)throw"Invalid API token string";return new j(s,i)}},G=j;G.separator=":";var Q=class{constructor(e,t=new F({host:"api.pinboard.in",basePath:["v1"]}),s=new F({host:"notes.pinboard.in",basePath:[]})){this.baseUrlOpts=t;this.notesUrlOpts=s;this.apiToken=G.fromString(e),this.baseUrlOpts.queryParams.push(new h({name:"auth_token",value:this.apiToken.toString(),noEncodeValue:!0}),new h({name:"format",value:"json"})),this.baseUrlOpts.parseJson=!0,this.notesUrlOpts.basePath.push(`u:${this.apiToken.user}`),this.posts=new oe(this.baseUrlOpts),this.tags=new ae(this.baseUrlOpts),this.notes=new le(this.baseUrlOpts),this.notePosts=new ce(this.notes,this.posts,this.notesUrlOpts),T(`Pinboard object for user ${this.apiToken.user} set up`)}};var Ve=k(require("obsidian"));function ue(n=""){let e=n.match(/^(#{1,6})\s+\S/);return e?e[1].length:null}function de(n,e){return n?"	":"".padStart(e," ")}function pe(n,e){return n.reduce((t,s)=>{let i=e(s);return t[i]=t[i]||[],t[i].push(s),t},{})}var z=class{constructor(e,t){this.app=e,this.settings=t,this.renderPin=this.renderPin.bind(this)}renderPin(e){let t=this.app.vault,s=de(t.getConfig("useTab"),t.getConfig("tabSize")),i=this.settings.tagPrefix,a=[];e.tags.forEach(u=>a.push(u.name));let c=a.filter(u=>!!u).map(u=>u.replace(/\s+/g,"-").toLowerCase()).map(u=>`#${i}${u}`).join(" "),d=e.extended;return`- [${e.description}](${e.href}) ${d} ${c}`.trimEnd()}render(e){let{sectionHeading:t}=this.settings,s=ue(t),i=[t];return i.push(...e.map(this.renderPin)),i.join(`
`)}};var Y=class extends O.Plugin{async onload(){console.log("[Pinboard] loading plugin"),this.scheduleNextSync=this.scheduleNextSync.bind(this),this.syncPinboard=this.syncPinboard.bind(this),this.tryToScheduleSync=this.tryToScheduleSync.bind(this),this.tryToSyncPinboard=this.tryToSyncPinboard.bind(this),this.addCommand({id:"pinboard-sync-cmd",name:"Sync",callback:()=>setTimeout(this.tryToSyncPinboard,20)}),await this.loadSettings(),this.settingsTab=new V(this.app,this),this.addSettingTab(this.settingsTab),this.app.workspace.onLayoutReady(this.onLayoutReady.bind(this))}onunload(){console.log("[Pinboard] unloading plugin")}async onLayoutReady(){this.settings.hasAcceptedDisclaimer&&this.settings.isSyncEnabled&&this.scheduleNextSync()}async tryToSyncPinboard(){this.settings.hasAcceptedDisclaimer?this.syncPinboard():new I(this.app,{cta:"Sync",onAccept:async()=>{await this.writeSettings({hasAcceptedDisclaimer:!0}),this.syncPinboard()},text:"Enabling sync will backfill your recent Pinboard into Obsidian. This means potentially creating or modifying hundreds of notes. Make sure to test the plugin in a test vault before continuing.",title:"Sync Now?"}).open()}async tryToScheduleSync(){this.settings.hasAcceptedDisclaimer?this.scheduleNextSync():new I(this.app,{cta:"Sync",onAccept:async()=>{await this.writeSettings({hasAcceptedDisclaimer:!0}),this.scheduleNextSync()},onCancel:async()=>{await this.writeSettings({isSyncEnabled:!1}),this.settingsTab.display()},text:"Enabling sync will backfill your recent Pinboard into Obsidian. This means potentially creating or modifying hundreds of notes. Make sure to test the plugin in a test vault before continuing.",title:"Sync Now?"}).open()}async getPostsFromPinboard(e,t){let s=new Q(t.apiToken),i=a=>{console.log(`API error: ${a}`)};return s.posts.recent([],t.recentCount)}async syncPinboard(){let e=new z(this.app,this.settings),t=this.settings.latestSyncTime||0,s=[];try{s=await this.getPostsFromPinboard(t,this.settings)}catch(a){new O.Notice("[Pinboard Sync] failed"),console.log(a);return}let i=pe(s.posts.filter(a=>a.time),a=>window.moment(a.time).startOf("day").format());await this.writePinsToSingleFile(i,e),new O.Notice("[Pinboard Sync] complete"),this.writeSettings({latestSyncTime:window.moment().unix()}),this.scheduleNextSync()}async writePinsToSingleFile(e,t){let i=`${this.settings.singleFileNoteName||"Pinboard Pins"}.md`,a=this.app.vault.getAbstractFileByPath(i),c="";a?c=await this.app.vault.read(a):a=await this.app.vault.create(i,"");let d="";for(let[u,r]of Object.entries(e)){let l=window.moment(u).format("YYYY-MM-DD"),P=`${l}
${t.render(r).trim()}

`;if(c.includes(l)){let $=new RegExp(`${l}[\\s\\S]*?(?=\\d{4}-\\d{2}-\\d{2}|$)`);c=c.replace($,P)}else d+=P}let p=d+c;await this.app.vault.modify(a,p.trim())}cancelScheduledSync(){this.syncTimeoutId!==void 0&&window.clearTimeout(this.syncTimeoutId)}scheduleNextSync(){let e=window.moment().unix();if(this.cancelScheduledSync(),!this.settings.isSyncEnabled||!this.settings.syncInterval){console.log("[Pinboard] scheduling skipped, no syncInterval set");return}let{latestSyncTime:t,syncInterval:s}=this.settings,i=s*1e3,a=Math.max(t+i-e,20);console.log(`[Pinboard] next sync scheduled in ${a}ms`),this.syncTimeoutId=window.setTimeout(this.syncPinboard,a)}async loadSettings(){this.settings=Object.assign({},X,await this.loadData()),this.settings.hasAcceptedDisclaimer||(this.settings.isSyncEnabled=!1)}async writeSettings(e){this.settings=Object.assign(this.settings,e),e.isSyncEnabled!==void 0?e.isSyncEnabled?this.tryToScheduleSync():this.cancelScheduledSync():e.syncInterval!==void 0&&this.settings.isSyncEnabled&&this.tryToScheduleSync(),await this.saveData(this.settings)}};0&&(module.exports={});
